# Moodle RAG Chatbot

ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ัะฐั-ะฑะพั ะดะปั ัะฐะฑะพัั ั ะดะพะบัะผะตะฝัะฐัะธะตะน Moodle, ะฟะพัััะพะตะฝะฝัะน ะฝะฐ ะฐััะธัะตะบัััะต RAG (Retrieval-Augmented Generation) ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ LangChain ะธ Ollama.

## ะัะพะฑะตะฝะฝะพััะธ

- ๐ **ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ** ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ Moodle ั ะฟะพะผะพััั ChromaDB
- ๐ค **ะะพะบะฐะปัะฝะฐั LLM ะผะพะดะตะปั** (Qwen2.5:7b) ัะตัะตะท Ollama ะดะปั ะณะตะฝะตัะฐัะธะธ ะพัะฒะตัะพะฒ
- ๐ **ะัะพัั-ัะทััะฝัะน ะฟะพะธัะบ** (ััััะบะธะต ะทะฐะฟัะพัั โ ะฐะฝะณะปะธะนัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั ั AI ะฟะตัะตะฒะพะดัะธะบะพะผ)
- ๐ **ะะฐะทะฐ ะทะฝะฐะฝะธะน**: ะะพะบัะผะตะฝัะฐัะธั Moodle ะฒ ะฒะตะบัะพัะฝะพะผ ัะพัะผะฐัะต (7121 ะดะพะบัะผะตะฝั)
- โก **REST API** ะดะปั ะธะฝัะตะณัะฐัะธะธ
- ๐พ **ะะฐะผััั ัะตััะธะน** ะดะปั ะบะพะฝัะตะบััะฝัั ะดะธะฐะปะพะณะพะฒ
- ๐ **LangChain ะฐััะธัะตะบัััะฐ** ะดะปั ัะฟัะพัะตะฝะธั ัะฐะทัะฐะฑะพัะบะธ
- ๐ **ะัะธะณะธะฝะฐะปัะฝัะต URL** ะธะท ะพัะธัะธะฐะปัะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ Moodle
- ๐ **ะะตัะฐะปัะฝัะต ะธะฝััััะบัะธะธ** ั ะฟะพัะฐะณะพะฒัะผะธ ััะบะพะฒะพะดััะฒะฐะผะธ

## ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ัััะฐะฝะพะฒะบะฐ

```bash
git clone <repository-url>
cd moodle-rag-bot
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# ะธะปะธ
.venv\Scripts\activate  # Windows

pip install poetry
poetry install
```

### 2. ะฃััะฐะฝะพะฒะบะฐ Ollama

```bash
# macOS
brew install ollama

# Linux
curl -fsSL https://ollama.ai/install.sh | sh

# ะะฐะฟััะบ ัะตัะฒะธัะฐ
brew services start ollama  # macOS
# ะธะปะธ
ollama serve  # Linux
```

### 3. ะะฐะณััะทะบะฐ LLM ะผะพะดะตะปะธ

```bash
# ะกะบะฐัะธะฒะฐะฝะธะต Qwen2.5:7b ะผะพะดะตะปะธ
ollama pull qwen2.5:7b
```

### 4. ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั (ะตัะปะธ ะฝัะถะฝะพ)

```bash
# ะะฐััะธะฝะณ XML ัะฐะนะปะพะฒ ะดะพะบัะผะตะฝัะฐัะธะธ
python scripts/parse_export_xml.py

# ะะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะฐะฝะบะธ
python scripts/chunk_docs.py

# ะะฐะณััะทะบะฐ ะฒ ะฒะตะบัะพัะฝัั ะฑะฐะทั
python scripts/ingest_chroma.py
```

### 5. ะะฐะฟััะบ API

```bash
python run_api.py
```

API ะฑัะดะตั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: http://localhost:8000

### 6. ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะขะตัั ะฝะฐ ััััะบะพะผ (ั ะฟัะฐะฒะธะปัะฝัะผ ะพัะพะฑัะฐะถะตะฝะธะตะผ Unicode)
curl -X POST "http://localhost:8000/api/v1/chat" \
  -H "Content-Type: application/json" \
  -d '{"session_id": "test", "message": "ะะฐะบ ัะพะทะดะฐัั ะฝะพะฒัะน ะบััั ะฒ Moodle?"}' | \
  python -c "import sys, json; data=json.load(sys.stdin); print(json.dumps(data, ensure_ascii=False, indent=2))"

# ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะธััะตะผั
curl http://localhost:8000/api/v1/health

# ะัะธะผะตั ะพัะฒะตัะฐ ั ะธััะพัะฝะธะบะฐะผะธ ะธ ัััะปะบะฐะผะธ:
# {
#   "answer": "1. **ะกะพะทะดะฐะฝะธะต ะฝะพะฒะพะณะพ ะฟัััะพะณะพ ะบัััะฐ**\n   - ะะพะนะดะธัะต ะฒ ัะธััะตะผั Moodle ั ะฐะบะบะฐัะฝัะพะผ ะฐะดะผะธะฝะธัััะฐัะพัะฐ...",
#   "sources": [
#     {
#       "title": "Create a course",
#       "url": "https://docs.moodle.org/403/en/Create_a_course",
#       "chunk_id": "chunk_0",
#       "score": 1.0
#     }
#   ],
#   "session_id": "test"
# }
```

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   FastAPI       โ    โ   ChromaDB      โ    โ   Ollama        โ
โ   REST API      โโโโโบโ   Vector DB     โโโโโบโ   Qwen2.5:7b    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   LangChain     โ    โ   HuggingFace   โ    โ   LangChain     โ
โ   Pipeline      โ    โ   Embeddings    โ    โ   LLM           โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ะะพะฝัะธะณััะฐัะธั

ะัะฝะพะฒะฝัะต ะฝะฐัััะพะนะบะธ ะฒ `app/core/config.py`:

- `llm_model_name`: ะะฐะทะฒะฐะฝะธะต ะผะพะดะตะปะธ Ollama (qwen2.5:7b)
- `embedding_model`: ะะพะดะตะปั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ (all-MiniLM-L6-v2)
- `top_k`: ะะพะปะธัะตััะฒะพ ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ (5)
- `llm_temperature`: ะขะตะผะฟะตัะฐัััะฐ ะณะตะฝะตัะฐัะธะธ (0.3)
- `llm_top_p`: Top-p ะฟะฐัะฐะผะตัั (0.9)

## API Endpoints

### POST /api/v1/chat
ะัะฝะพะฒะฝะพะน ัะฝะดะฟะพะธะฝั ะดะปั ัะฐัะฐ.

**ะะฐะฟัะพั:**
```json
{
  "session_id": "unique_session_id",
  "message": "ะะฐั ะฒะพะฟัะพั"
}
```

**ะัะฒะตั:**
```json
{
  "answer": "ะัะฒะตั ัะธััะตะผั",
  "sources": [
    {
      "title": "ะะฐะทะฒะฐะฝะธะต ะดะพะบัะผะตะฝัะฐ",
      "url": "https://docs.moodle.org/403/en/Document_Name",
      "chunk_id": "ID ัะฐะฝะบะฐ",
      "score": 0.85
    }
  ],
  "session_id": "unique_session_id"
}
```

### GET /api/v1/health
ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะธััะตะผั.

## ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- **ะัะตะผั ะพัะฒะตัะฐ**: ~3-5 ัะตะบัะฝะด
- **ะะฐะทะผะตั LLM ะผะพะดะตะปะธ**: ~4.7GB (Qwen2.5:7b)
- **ะะพะดะดะตัะถะธะฒะฐะตะผัะต ัะทัะบะธ**: ะะฝะณะปะธะนัะบะธะน, ััััะบะธะน (ั AI ะฟะตัะตะฒะพะดัะธะบะพะผ)
- **ะััะธัะตะบัััะฐ**: LangChain + Ollama
- **ะะฐะทะฐ ะทะฝะฐะฝะธะน**: 7121 ะดะพะบัะผะตะฝั ะฒ ChromaDB
- **ะะฐะบัะธะผัะผ ัะพะบะตะฝะพะฒ**: 4096 ะดะปั ะฟะพะปะฝัั ะพัะฒะตัะพะฒ

## ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.11+
- 8GB RAM (ัะตะบะพะผะตะฝะดัะตััั)
- 10GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ ะฝะฐ ะดะธัะบะต
- Ollama

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
moodle-rag-bot/
โโโ app/
โ   โโโ api/           # FastAPI ะผะฐัััััั
โ   โโโ core/          # ะะพะฝัะธะณััะฐัะธั ะธ ะปะพะณะธัะพะฒะฐะฝะธะต
โ   โโโ rag/           # RAG ะบะพะผะฟะพะฝะตะฝัั (LLM, Retriever, Pipeline, Prompts)
โ   โโโ schemas.py     # Pydantic ััะตะผั
โโโ data/              # ะะฐะฝะฝัะต ะธ ะฒะตะบัะพัะฝะฐั ะฑะฐะทะฐ
โโโ models/            # LLM ะผะพะดะตะปะธ
โโโ scripts/           # ะกะบัะธะฟัั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั
โโโ tests/             # ะขะตััั
```

## ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **LangChain** โ ะพัะฝะพะฒะฝะพะน ััะตะนะผะฒะพัะบ ะดะปั RAG
- **Ollama** โ ะปะพะบะฐะปัะฝัะน ะทะฐะฟััะบ LLM ะผะพะดะตะปะตะน
- **Qwen2.5:7b** โ ัะทัะบะพะฒะฐั ะผะพะดะตะปั ะดะปั ะณะตะฝะตัะฐัะธะธ ะพัะฒะตัะพะฒ
- **ChromaDB** โ ะฒะตะบัะพัะฝะพะต ััะฐะฝะธะปะธัะต
- **HuggingFace Embeddings** โ ะผะพะดะตะปั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ (all-MiniLM-L6-v2)
- **HuggingFace Transformers** โ AI ะฟะตัะตะฒะพะดัะธะบ (MarianMT)
- **FastAPI** โ ะฒะตะฑ-ััะตะนะผะฒะพัะบ
- **Pydantic** โ ะฒะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั
- **Poetry** โ ัะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ

## ะะธัะตะฝะทะธั

MIT License

## ะะพะดะดะตัะถะบะฐ

ะะปั ะฒะพะฟัะพัะพะฒ ะธ ะฟัะตะดะปะพะถะตะฝะธะน ัะพะทะดะฐะฒะฐะนัะต issues ะฒ ัะตะฟะพะทะธัะพัะธะธ. 